version: v1.0
name: Ruby

agent:
  machine:
    type: e2-standard-2
    os_image: ubuntu2204

blocks:
  - name: Run Tests üë©üèΩ‚Äçüî¨
    task:
      secrets:
        - name: codecov-workos-ruby
      jobs:
        - name: Ruby
          matrix:
            - env_var: RUBY_VERSION
              values:
                - '2.7'
                - '3.0'
                - '3.1'
                - '3.2'
                - '3.3'
          commands:
            - checkout
            - sem-version ruby $RUBY_VERSION
            - which bundle
            - which ruby
            - bundle --version
            - ruby --version
            - bundle install
            - bundle exec rubocop
            - bundle exec rspec
promotions:
  - name: Deploy workos-rb to rubygems
    pipeline_file: rubygems.yml
